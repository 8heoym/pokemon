# 템플릿 시스템 테스트 케이스 시트

## 1. 단위 테스트 케이스

### 1.1 ProblemTemplateService 테스트

| 테스트 ID | 테스트 케이스 | 입력 | 예상 출력 | 우선순위 |
|-----------|---------------|------|-----------|----------|
| UT-001 | 템플릿 변수 생성 테스트 | template: {a: {min:2, max:9}}, multiplicationTable: 3 | variables.a = 3, variables.b = 2~9 범위 | High |
| UT-002 | 템플릿 내용 렌더링 테스트 | template: "{pokemon}가 {a}마리씩", pokemon: "피카츄", variables: {a:3} | "피카츄가 3마리씩" | High |
| UT-003 | 답 계산 검증 | variables: {a:3, b:4} | answer = 12 | Critical |
| UT-004 | 세션 저장 테스트 | userId, renderedProblem | problem_instances 테이블에 정상 저장 | High |
| UT-005 | 세션 조회 테스트 | userId, problemId | 유효한 RenderedProblem 반환 | High |
| UT-006 | 세션 만료 테스트 | 31분 전 생성된 세션 | null 반환 | Medium |
| UT-007 | 중복 세션 방지 테스트 | 동일 사용자 새 문제 생성 | 기존 세션 삭제 후 새 세션 생성 | Medium |

### 1.2 HybridProblemService 테스트

| 테스트 ID | 테스트 케이스 | 입력 | 예상 출력 | 우선순위 |
|-----------|---------------|------|-----------|----------|
| UT-101 | 전략 결정 - 템플릿 우선 | templates.length >= 3 | TEMPLATE_PRIORITY | High |
| UT-102 | 전략 결정 - 하이브리드 | templates.length >= 1, userSolved > 10 | HYBRID_ENHANCED | High |
| UT-103 | 전략 결정 - AI 전용 | templates.length = 0 | AI_PERSONALIZED | High |
| UT-104 | 포켓몬 선택 로직 | multiplicationTable: 3 | 3단 포켓몬 반환 | Medium |
| UT-105 | 포켓몬 폴백 선택 | 해당 구구단 포켓몬 없음 | 전체 포켓몬에서 랜덤 선택 | Medium |
| UT-106 | 답안 검증 로직 | userAnswer: 12, correctAnswer: 12 | isCorrect: true | Critical |
| UT-107 | 경험치 계산 | difficulty: 2, timeSpent: 15 | baseExp(20) + timeBonus(15) = 35 | Low |

## 2. 통합 테스트 케이스

### 2.1 API 엔드포인트 테스트

#### 문제 생성 API (POST /api/problems/generate)

| 테스트 ID | 시나리오 | 요청 데이터 | 예상 응답 | HTTP 상태 | 우선순위 |
|-----------|----------|------------|----------|----------|----------|
| IT-001 | 정상적인 문제 생성 | userId: "user1", multiplicationTable: 3, difficulty: 1 | problem 객체 + pokemon 객체 반환 | 200 | Critical |
| IT-002 | 필수 파라미터 누락 | userId 누락 | error: "사용자 ID와 구구단이 필요합니다." | 400 | High |
| IT-003 | 잘못된 구구단 범위 | multiplicationTable: 10 | error: "구구단은 2단부터 9단까지만 가능합니다." | 400 | High |
| IT-004 | 잘못된 난이도 | difficulty: 4 | 기본값 1로 처리 또는 오류 | 400/200 | Medium |
| IT-005 | 템플릿 시스템 장애 상황 | DB 연결 실패 | AI 생성으로 폴백, 정상 응답 | 200 | High |

#### 답안 제출 API (POST /api/problems/submit)

| 테스트 ID | 시나리오 | 요청 데이터 | 예상 응답 | HTTP 상태 | 우선순위 |
|-----------|----------|------------|----------|----------|----------|
| IT-101 | 정답 제출 | userId, problemId, answer: 12 (정답) | isCorrect: true, 포켓몬 잡기 결과 | 200 | Critical |
| IT-102 | 오답 제출 | userId, problemId, answer: 10 (오답) | isCorrect: false, 정답 표시 | 200 | Critical |
| IT-103 | 만료된 문제 제출 | 31분 전 문제 ID | error: "문제가 만료되었거나..." | 404 | High |
| IT-104 | 존재하지 않는 문제 | 잘못된 problemId | error: "문제를 찾을 수 없습니다." | 404 | High |
| IT-105 | 필수 파라미터 누락 | answer 누락 | error: "필수 정보가 누락되었습니다." | 400 | Medium |

### 2.2 서비스 간 연동 테스트

| 테스트 ID | 시나리오 | 테스트 내용 | 예상 결과 | 우선순위 |
|-----------|----------|-------------|----------|----------|
| IT-201 | 템플릿-포켓몬 연동 | 3단 템플릿 + 3단 포켓몬 선택 | 의미적으로 일치하는 문제 생성 | High |
| IT-202 | 세션-게임 연동 | 정답 시 포켓몬 잡기 | 포켓몬 잡기 결과가 답안 응답에 포함 | High |
| IT-203 | 이력-추천 연동 | 최근 사용 템플릿 제외 | 7일 내 사용 템플릿 제외된 목록 반환 | Medium |
| IT-204 | 난이도-템플릿 매칭 | difficulty: 2 요청 | difficulty 2인 템플릿만 조회 | Medium |

## 3. 경계값 테스트 케이스

### 3.1 구구단 범위 테스트

| 테스트 ID | 입력값 | 예상 결과 | 우선순위 |
|-----------|--------|----------|----------|
| BT-001 | multiplicationTable: 1 | 400 오류 | High |
| BT-002 | multiplicationTable: 2 | 정상 처리 | Critical |
| BT-003 | multiplicationTable: 9 | 정상 처리 | Critical |
| BT-004 | multiplicationTable: 10 | 400 오류 | High |
| BT-005 | multiplicationTable: -1 | 400 오류 | Medium |
| BT-006 | multiplicationTable: 0 | 400 오류 | Medium |

### 3.2 세션 시간 경계값 테스트

| 테스트 ID | 시간 조건 | 예상 결과 | 우선순위 |
|-----------|-----------|----------|----------|
| BT-101 | 생성 직후 (0분) | 정상 조회 가능 | High |
| BT-102 | 29분 59초 후 | 정상 조회 가능 | High |  
| BT-103 | 정확히 30분 후 | 조회 불가 (만료) | Critical |
| BT-104 | 31분 후 | 조회 불가 (만료) | Critical |

## 4. 오류 처리 테스트 케이스

### 4.1 데이터베이스 오류 상황

| 테스트 ID | 오류 상황 | 테스트 방법 | 예상 동작 | 우선순위 |
|-----------|-----------|-------------|----------|----------|
| ET-001 | Supabase 연결 실패 | 네트워크 차단 | AI 생성으로 폴백 | Critical |
| ET-002 | 템플릿 테이블 조회 실패 | 테이블 권한 제거 | AI 생성으로 폴백 | High |
| ET-003 | 세션 저장 실패 | 디스크 용량 부족 시뮬레이션 | 오류 응답, 재시도 안내 | High |
| ET-004 | RPC 함수 실행 실패 | 함수 삭제 후 호출 | 로그 경고, 기능 계속 | Medium |

### 4.2 비즈니스 로직 오류

| 테스트 ID | 오류 상황 | 테스트 방법 | 예상 동작 | 우선순위 |
|-----------|-----------|-------------|----------|----------|
| ET-101 | 사용 가능한 템플릿 없음 | 모든 템플릿 비활성화 | AI 생성으로 폴백 | High |
| ET-102 | 적합한 포켓몬 없음 | 해당 구구단 포켓몬 모두 삭제 | 전체 포켓몬에서 랜덤 선택 | Medium |
| ET-103 | 변수 생성 실패 | 잘못된 템플릿 변수 설정 | 오류 응답 및 AI 폴백 | Medium |
| ET-104 | 템플릿 렌더링 실패 | 존재하지 않는 변수 참조 | 오류 응답 및 AI 폴백 | Medium |

## 5. 성능 테스트 케이스

### 5.1 응답 시간 테스트

| 테스트 ID | 시나리오 | 목표 시간 | 측정 방법 | 우선순위 |
|-----------|----------|-----------|-----------|----------|
| PT-001 | 템플릿 문제 생성 | < 1초 | 100회 연속 호출 평균 | High |
| PT-002 | AI 문제 생성 | < 3초 | Claude API 호출 포함 평균 | Medium |
| PT-003 | 답안 제출 처리 | < 0.5초 | 세션 조회 + DB 저장 시간 | High |
| PT-004 | 사용 가능 템플릿 조회 | < 0.2초 | 복잡한 필터링 쿼리 시간 | Medium |

### 5.2 동시성 테스트

| 테스트 ID | 동시 사용자 수 | 테스트 기간 | 성공 기준 | 우선순위 |
|-----------|----------------|-------------|-----------|----------|
| PT-101 | 10명 | 5분 | 모든 요청 정상 처리 | Medium |
| PT-102 | 50명 | 10분 | 95% 이상 요청 성공 | Medium |
| PT-103 | 100명 | 15분 | 90% 이상 요청 성공, 응답시간 < 5초 | High |

## 6. 데이터 정합성 테스트 케이스

### 6.1 세션 관리 테스트

| 테스트 ID | 시나리오 | 검증 포인트 | 예상 결과 | 우선순위 |
|-----------|----------|-------------|----------|----------|
| DT-001 | 동일 사용자 여러 문제 생성 | problem_instances 테이블 | 하나의 활성 세션만 존재 | Critical |
| DT-002 | 세션 만료 후 정리 | 만료된 세션 조회 | 자동 정리 또는 조회 불가 | High |
| DT-003 | 답변 완료 후 상태 | is_answered 플래그 | true로 업데이트됨 | High |

### 6.2 사용자 이력 추적 테스트

| 테스트 ID | 시나리오 | 검증 포인트 | 예상 결과 | 우선순위 |
|-----------|----------|-------------|----------|----------|
| DT-101 | 템플릿 사용 이력 기록 | user_template_history | upsert 방식으로 정확 기록 | High |
| DT-102 | 최근 사용 템플릿 제외 | 7일 내 사용 템플릿 | 추천 목록에서 제외 | Medium |
| DT-103 | 답안 기록 추적 | user_answers 테이블 | 모든 답안 정확 기록 | High |

## 7. 사용자 시나리오 기반 테스트 케이스

### 7.1 신규 사용자 시나리오

| 단계 | 액션 | 예상 결과 | 검증 포인트 |
|------|------|----------|-------------|
| 1 | 첫 문제 생성 요청 (3단) | AI_PERSONALIZED 전략 선택 | 로그에 전략 출력 확인 |
| 2 | 문제 확인 | AI 생성 문제 반환 | 포켓몬 + 수학 문제 일치성 |
| 3 | 정답 제출 | 정답 확인 + 경험치 획득 | user_answers 기록 확인 |
| 4 | 동일 구구단 재요청 | 여전히 AI 생성 | 신규 사용자 유지 |

### 7.2 숙련 사용자 시나리오

| 단계 | 액션 | 예상 결과 | 검증 포인트 |
|------|------|----------|-------------|
| 1 | 사용자 문제 풀이 이력 11개 생성 | user_answers에 11개 기록 | 정답 이력 확인 |
| 2 | 템플릿 1개 이상 활성화 | problem_templates 확인 | is_active: true |
| 3 | 문제 생성 요청 | HYBRID_ENHANCED 전략 | 60% 템플릿, 40% AI |
| 4 | 여러 번 요청으로 전략 분포 확인 | 10회 요청 | 템플릿 6회, AI 4회 대략적 비율 |

### 7.3 템플릿 재활용 시나리오

| 단계 | 액션 | 예상 결과 | 검증 포인트 |
|------|------|----------|-------------|
| 1 | 특정 템플릿으로 문제 생성 | 템플릿 기반 문제 반환 | template_id 기록 |
| 2 | 동일 구구단 즉시 재요청 | 다른 템플릿 또는 AI 생성 | 최근 사용 템플릿 제외 |
| 3 | 8일 후 동일 템플릿 요청 | 동일 템플릿 재사용 가능 | 7일 제외 규칙 적용 |

## 8. 회귀 테스트 케이스 (기존 시스템 vs 새 시스템)

### 8.1 API 호환성 테스트

| 테스트 ID | API | 구 시스템 응답 | 신 시스템 응답 | 호환성 검증 |
|-----------|-----|---------------|---------------|--------------|
| RT-001 | POST /api/problems/generate | MathProblem 객체 | MathProblem + Pokemon 객체 | 하위 호환성 유지 |
| RT-002 | POST /api/problems/submit | 정답 확인 결과 | 정답 확인 + 템플릿 통계 | 기존 응답 형식 유지 |
| RT-003 | GET /api/problems/:id/hint | 힌트 텍스트 | 템플릿 기반 힌트 | 동일한 힌트 품질 |

### 8.2 문제 품질 비교 테스트

| 테스트 ID | 비교 항목 | 구 시스템 | 신 시스템 | 품질 기준 |
|-----------|-----------|----------|----------|-----------|
| RT-101 | 문제 다양성 | AI 생성 다양성 | 템플릿 + 포켓몬 조합 다양성 | 동등 이상 |
| RT-102 | 수학적 정확성 | AI 계산 정확도 | 템플릿 계산 정확도 | 100% 정확 |
| RT-103 | 문제 생성 속도 | AI API 호출 시간 | 템플릿 렌더링 시간 | 신시스템 더 빠름 |
| RT-104 | 교육적 일관성 | AI 의존적 | 템플릿 기반 일관성 | 향상됨 |

## 9. 스트레스 테스트 케이스

### 9.1 고부하 상황 테스트

| 테스트 ID | 부하 조건 | 테스트 기간 | 모니터링 지표 | 성공 기준 |
|-----------|-----------|-------------|---------------|-----------|
| ST-001 | 초당 10 문제 생성 | 10분 | 응답시간, 메모리 사용량 | 평균 응답시간 < 2초 |
| ST-002 | 초당 50 답안 제출 | 10분 | DB 연결 수, 오류율 | 오류율 < 1% |
| ST-003 | 1000개 동시 세션 | 30분 | 메모리 사용량, DB 성능 | 메모리 증가 < 50MB |

### 9.2 장기 실행 테스트

| 테스트 ID | 실행 조건 | 테스트 기간 | 모니터링 대상 | 성공 기준 |
|-----------|-----------|-------------|---------------|-----------|
| ST-101 | 연속 24시간 운영 | 24시간 | 메모리 누수, 세션 정리 | 메모리 안정, 세션 자동 정리 |
| ST-102 | 주기적 부하 (피크타임) | 1주일 | 시스템 안정성 | 99% 가용성 |

## 10. 보안 테스트 케이스

### 10.1 인증/인가 테스트

| 테스트 ID | 시나리오 | 테스트 방법 | 예상 결과 | 우선순위 |
|-----------|----------|-------------|----------|----------|
| ST-201 | 타인 세션 접근 시도 | 다른 userId로 problemId 조회 | 접근 거부 | Critical |
| ST-202 | SQL 인젝션 시도 | 악의적 userId 입력 | 안전하게 처리됨 | High |
| ST-203 | XSS 시도 | 스크립트 포함 answer 제출 | 이스케이프 처리됨 | Medium |

## 테스트 실행 우선순위

**Critical**: 시스템 핵심 기능, 데이터 정확성
**High**: 주요 사용자 시나리오, 오류 처리  
**Medium**: 성능 최적화, 사용성
**Low**: 보조 기능, 로깅

## 예상 테스트 수행 시간

- 단위 테스트: 2시간
- 통합 테스트: 4시간  
- 회귀 테스트: 3시간
- 스트레스 테스트: 6시간 (대부분 자동 실행)
- **총 소요시간**: 약 15시간